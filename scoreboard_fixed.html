<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÜ Live Scoreboard - AgentDaf1</title>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        
        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        /* UpdateBar+ Styles */
        .updatebar-plus {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .update-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .last-update {
            font-size: 0.9em;
            color: #666;
        }
        
        .update-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        /* Tab Navigation */
        .tab-navigation {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .tab-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            background: transparent;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #666;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab-btn:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Scoreboard Container */
        .scoreboard-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 1em;
            opacity: 0.9;
        }
        
        /* Controls */
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .search-box {
            display: flex;
            align-items: center;
            background: #f8f9fa;
            border-radius: 25px;
            padding: 12px 20px;
            flex: 1;
            max-width: 400px;
            border: 2px solid transparent;
            transition: border-color 0.3s ease;
        }
        
        .search-box:focus-within {
            border-color: #667eea;
        }
        
        .search-input {
            border: none;
            background: none;
            outline: none;
            width: 100%;
            font-size: 16px;
            padding: 5px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        /* Table Styles */
        .table-wrapper {
            overflow-x: auto;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .scoreboard-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        .scoreboard-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
        }
        
        .scoreboard-table th:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }
        
        .scoreboard-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .scoreboard-table tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }
        
        .rank-1 { background: linear-gradient(135deg, #FFD700, #FFA500) !important; color: white; }
        .rank-2 { background: linear-gradient(135deg, #C0C0C0, #808080) !important; color: white; }
        .rank-3 { background: linear-gradient(135deg, #CD7F32, #8B4513) !important; color: white; }
        
        .alliance-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 600;
            background: #f0f0f0;
            color: #333;
        }
        
        .alliance-RFR { background: #4CAF50; color: white; }
        .alliance-WIP { background: #2196F3; color: white; }
        .alliance-SW { background: #FF9800; color: white; }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .header h1 { font-size: 2em; }
            .stats-grid { grid-template-columns: 1fr; }
            .controls { flex-direction: column; }
            .search-box { max-width: 100%; }
            .tab-buttons { justify-content: center; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üèÜ Live Scoreboard</h1>
            <p>AgentDaf1 Competition - Real-time Rankings</p>
        </div>

        <!-- UpdateBar+ -->
        <div class="updatebar-plus">
            <div class="update-status">
                <div class="status-indicator"></div>
                <span class="last-update" id="lastUpdate">Loading...</span>
            </div>
            <div class="update-controls">
                <button class="btn" onclick="refreshData()">
                    üîÑ Refresh
                </button>
                <button class="btn btn-secondary" onclick="exportData()">
                    üì• Export
                </button>
                <button class="btn" onclick="autoRefreshToggle()">
                    ‚è±Ô∏è Auto: <span id="autoStatus">OFF</span>
                </button>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchTab('overall')">
                    üèÜ Overall Rankings
                </button>
                <button class="tab-btn" onclick="switchTab('positive')">
                    üìà Positive Scores
                </button>
                <button class="tab-btn" onclick="switchTab('negative')">
                    üìâ Negative Scores
                </button>
                <button class="tab-btn" onclick="switchTab('alliance')">
                    ü§ù Alliance Rankings
                </button>
                <button class="tab-btn" onclick="switchTab('combined')">
                    üîÑ Combined View
                </button>
            </div>
        </div>

        <!-- Overall Tab -->
        <div id="overall-tab" class="tab-content active">
            <div class="scoreboard-container">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalPlayers">-</div>
                        <div class="stat-label">Total Players</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="avgScore">-</div>
                        <div class="stat-label">Average Score</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalAlliances">-</div>
                        <div class="stat-label">Alliances</div>
                    </div>
                </div>
                
                <div class="controls">
                    <div class="search-box">
                        üîç
                        <input type="text" class="search-input" placeholder="Search players..." id="overallSearch" onkeyup="filterTable('overall')">
                    </div>
                    <div class="filter-buttons">
                        <button class="btn btn-secondary" onclick="loadSampleData()">üéÆ Load Sample</button>
                    </div>
                </div>
                
                <div class="table-wrapper">
                    <table class="scoreboard-table" id="overallTable">
                        <thead>
                            <tr>
                                <th onclick="sortTable('overall', 0)">Rank ‚Üï</th>
                                <th onclick="sortTable('overall', 1)">Player ‚Üï</th>
                                <th onclick="sortTable('overall', 2)">Score ‚Üï</th>
                                <th onclick="sortTable('overall', 3)">Alliance ‚Üï</th>
                                <th onclick="sortTable('overall', 4)">Monarch ID ‚Üï</th>
                            </tr>
                        </thead>
                        <tbody id="overallTableBody">
                            <tr><td colspan="5" class="loading"><div class="spinner"></div>Loading data...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Other tabs (simplified for now) -->
        <div id="positive-tab" class="tab-content">
            <div class="scoreboard-container">
                <div class="loading">
                    <h3>üìà Positive Scores</h3>
                    <p>Players with positive scores only</p>
                </div>
            </div>
        </div>

        <div id="negative-tab" class="tab-content">
            <div class="scoreboard-container">
                <div class="loading">
                    <h3>üìâ Negative Scores</h3>
                    <p>Players with negative scores only</p>
                </div>
            </div>
        </div>

        <div id="alliance-tab" class="tab-content">
            <div class="scoreboard-container">
                <div class="loading">
                    <h3>ü§ù Alliance Rankings</h3>
                    <p>Team performance and statistics</p>
                </div>
            </div>
        </div>

        <div id="combined-tab" class="tab-content">
            <div class="scoreboard-container">
                <div class="loading">
                    <h3>üîÑ Combined View</h3>
                    <p>Complete overview with all data</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentData = {
            overall: [],
            positive: [],
            negative: [],
            alliance: [],
            combined: []
        };
        
        let autoRefreshInterval = null;
        let sortDirections = {};

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateLastRefreshTime();
        });

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        // Main data loading function
        async function loadData() {
            try {
                const response = await fetch('scoreboard-data.json');
                const data = await response.json();
                
                // Process data for all tabs
                processDataForAllTabs(data);
                
                // Update stats
                updateStats();
                
                // Populate overall table
                populateTable('overall');
                
                updateLastRefreshTime();
                
            } catch (error) {
                console.error('Error loading data:', error);
                loadSampleData();
            }
        }

        // Process data for all tabs
        function processDataForAllTabs(data) {
            // Overall data
            if (data.players) {
                currentData.overall = data.players.map(p => ({
                    rank: p.rank || 0,
                    name: p.name || '',
                    score: p.score || 0,
                    alliance: p.alliance || 'Unaligned',
                    monarchId: p.monarchId || ''
                }));
            }
            
            // Positive scores
            currentData.positive = currentData.overall.filter(p => p.score > 0);
            
            // Negative scores  
            currentData.negative = currentData.overall.filter(p => p.score < 0);
            
            // Alliance data
            const allianceMap = {};
            currentData.overall.forEach(player => {
                if (!allianceMap[player.alliance]) {
                    allianceMap[player.alliance] = {
                        name: player.alliance,
                        totalScore: 0,
                        members: 0,
                        avgScore: 0
                    };
                }
                allianceMap[player.alliance].totalScore += player.score;
                allianceMap[player.alliance].members++;
            });
            
            currentData.alliance = Object.values(allianceMap).map(alliance => ({
                ...alliance,
                avgScore: alliance.members > 0 ? alliance.totalScore / alliance.members : 0
            })).sort((a, b) => b.totalScore - a.totalScore);
            
            // Combined view
            currentData.combined = currentData.overall.map(player => ({
                rank: player.rank,
                name: player.name,
                score: player.score,
                type: getPlayerType(player.score),
                status: 'Active',
                alliance: player.alliance
            }));
        }

        // Get player type based on score
        function getPlayerType(score) {
            if (score > 10000000000) return 'Leader';
            if (score > 5000000000) return 'Elite';
            if (score > 1000000000) return 'Warrior';
            if (score > 0) return 'Striker';
            return 'Developing';
        }

        // Update statistics
        function updateStats() {
            const totalPlayers = currentData.overall.length;
            const avgScore = totalPlayers > 0 ? 
                currentData.overall.reduce((sum, p) => sum + p.score, 0) / totalPlayers : 0;
            const totalAlliances = currentData.alliance.length;
            
            document.getElementById('totalPlayers').textContent = totalPlayers;
            document.getElementById('avgScore').textContent = formatNumber(avgScore);
            document.getElementById('totalAlliances').textContent = totalAlliances;
        }

        // Populate specific table
        function populateTable(tabName) {
            const tbody = document.getElementById(tabName + 'TableBody');
            const data = currentData[tabName] || [];
            
            if (data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" style="text-align:center;padding:50px;">No data available</td></tr>`;
                return;
            }
            
            tbody.innerHTML = data.map((item, index) => {
                const rankClass = index < 3 ? `rank-${index + 1}` : '';
                return `
                    <tr class="${rankClass}">
                        <td><strong>${item.rank || index + 1}</strong></td>
                        <td>${item.name}</td>
                        <td>${formatNumber(item.score)}</td>
                        <td><span class="alliance-badge alliance-${item.alliance}">${item.alliance}</span></td>
                        <td>${item.monarchId || ''}</td>
                    </tr>
                `;
            }).join('');
        }

        // Format numbers
        function formatNumber(num) {
            if (num >= 1000000000) return (num / 1000000000).toFixed(1) + 'B';
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return Math.round(num).toString();
        }

        // Search/Filter functionality
        function filterTable(tabName) {
            const input = document.getElementById(tabName + 'Search');
            const filter = input.value.toLowerCase();
            const tbody = document.getElementById(tabName + 'TableBody');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let row of rows) {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(filter) ? '' : 'none';
            }
        }

        // Sort table
        function sortTable(tabName, columnIndex) {
            const table = document.getElementById(tabName + 'Table');
            const tbody = table.getElementsByTagName('tbody')[0];
            const rows = Array.from(tbody.getElementsByTagName('tr'));
            
            const key = `${tabName}_${columnIndex}`;
            sortDirections[key] = !sortDirections[key];
            
            rows.sort((a, b) => {
                const aValue = a.getElementsByTagName('td')[columnIndex].textContent;
                const bValue = b.getElementsByTagName('td')[columnIndex].textContent;
                
                const aNum = parseFloat(aValue.replace(/[^0-9.-]/g, ''));
                const bNum = parseFloat(bValue.replace(/[^0-9.-]/g, ''));
                
                if (!isNaN(aNum) && !isNaN(bNum)) {
                    return sortDirections[key] ? aNum - bNum : bNum - aNum;
                }
                
                return sortDirections[key] ? 
                    aValue.localeCompare(bValue) : 
                    bValue.localeCompare(aValue);
            });
            
            rows.forEach(row => tbody.appendChild(row));
        }

        // Refresh data
        function refreshData() {
            loadData();
        }

        // Auto refresh toggle
        function autoRefreshToggle() {
            const statusSpan = document.getElementById('autoStatus');
            
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
                statusSpan.textContent = 'OFF';
            } else {
                autoRefreshInterval = setInterval(refreshData, 30000); // 30 seconds
                statusSpan.textContent = 'ON';
            }
        }

        // Export data
        function exportData() {
            const dataStr = JSON.stringify(currentData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            saveAs(dataBlob, 'scoreboard-export.json');
        }

        // Load sample data
        function loadSampleData() {
            const sampleData = {
                players: [
                    {rank: 1, name: "JuggMasterB", score: 12710411052, alliance: "RFR", monarchId: "227625628"},
                    {rank: 2, name: "aadDoƒü”ì”ì", score: 7425783805, alliance: "WIP", monarchId: "213124942"},
                    {rank: 3, name: "Mobile Suit", score: 4756750524, alliance: "WIP", monarchId: "227565900"},
                    {rank: 4, name: "üáπüá∑TURK", score: 3309186482, alliance: "WIP", monarchId: "227680893"},
                    {rank: 5, name: "Battlefish23", score: 3047347132, alliance: "RFR", monarchId: "227503580"}
                ]
            };
            
            processDataForAllTabs(sampleData);
            updateStats();
            populateTable('overall');
            updateLastRefreshTime();
        }

        // Update last refresh time
        function updateLastRefreshTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('de-DE', { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            });
            document.getElementById('lastUpdate').textContent = `Last update: ${timeString}`;
        }
    </script>
</body>
</html>